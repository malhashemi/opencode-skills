name: Publish Switch

# This is the ENTRY POINT workflow for npm Trusted Publishing
# Register THIS workflow filename on npmjs.com as your trusted publisher
# It routes to the appropriate publishing workflow based on trigger

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      version:
        description: "Version to publish (e.g., 0.1.3)"
        required: true

jobs:
  # Automated releases via Release Please (triggered by push to main)
  release-please:
    if: github.event_name == 'push'
    uses: ./.github/workflows/release-please.yml
    permissions:
      id-token: write
      contents: write
      pull-requests: write

  # Manual publishing (triggered by workflow_dispatch)
  manual-publish:
    if: github.event_name == 'workflow_dispatch'
    uses: ./.github/workflows/publish.yml
    permissions:
      id-token: write
      contents: read
    with:
      version: ${{ github.event.inputs.version }}
